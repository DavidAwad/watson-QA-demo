<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="stylesheets/style.css">
	<title>Ask Watson</title>
</head>
<body>
	<p><b>Ask a question like the following:</b></p>

	<ul>
		<li>
			<p> "Is it safe to travel to <i>X</i>?"</p>
		</li>
		<li>
			<p> "Is there a ferry from <i>X</i> to <i>Y</i>?"</p>
		</li>
		<li>
			<p> "Can I bring my <i>X</i> through airport security?"</p>
		</li>
	</ul>

	<div id="output"></div>
	<div class="askContent">
		<input type="text" id="question" class="textbox" value=""/>
		<input type="button" class="askButton" value="ASK" onclick="ask()"/>
	</div>

	<script src="jquery/jquery-1.11.2.min.js"></script>
	<script>
		// Set focus to the question box
		document.getElementById("question").focus();

		// Presenting Enter in the question box will ask the question
		$("#question").keyup(function(event) {
			if (event.keyCode == 13) {
				ask();
			}
		});

		// Displays a formatted question or answer to the page
		function showOutput(classType, output) {
			var elementSeparator = document.createElement('div');
			elementSeparator.setAttribute('class', classType);
			elementSeparator.innerHTML = output;
			document.getElementById('output').appendChild(elementSeparator);

			var elementSeparator = document.createElement('div');
			elementSeparator.setAttribute('class', 'messageSeparator');
			elementSeparator.innerHTML = '&nbsp';
			document.getElementById('output').appendChild(elementSeparator);
		}

		// Posts a question to the url: /question and processes the answer
		function ask() {
			var myQuestion = document.getElementById('question').value;

			var questionEntity = {
				'question' : myQuestion
			};

			showOutput('questionContent', myQuestion);
			$('html, body').animate({ scrollTop : $(document).height() }, 'slow');

			document.getElementById('question').value = '';

			$.ajax({
				type : 'POST',
				data : questionEntity,
				dataType : 'json',
				url : '/question',
				success : function(r, msg) {
					if (r.answer !== undefined) {
						showOutput('answerContent', r.answer);
						document.getElementById('question').focus();

						$('html, body').animate({ scrollTop : $(document).height() }, 'slow');
					}
					else {
						console.log('The respoonse back was undefined');
						showOutput('answerContent', 'Sorry, I have no response to your question.');
					}
				},
				error : function(r, msg, e) {
					var errorText = '';
					if (r.responseText) {
						errorText = e + ' ' + r.responseText;
					}
					else {
						errorText = e;
					}
					console.log(errorText);
					showOutput('answerContent', 'Sorry, I am unable to respond to your question');
				}
			})
		}
	</script>
</body>
</html>
